  <!DOCTYPE html>

   <html lang="ko">
  <head>
      <title>Diablo2</title> 
  <meta charset="utf-8" />
  <meta name="application-name" content="coreflex"/>
  <meta name="viewport" content="width=device-width, initial-scale=1 , viewport-fit=cover">
  <meta name="description" content="Diablo2 Profile">
  <meta name="robots" content="index, follow">
  <meta name="keywords" content="Diablo2 Profile" />

  <meta property="og:type" content="website">
  <meta property="og:description" content="Diablo2 Profile Page.">
  <meta property="og:site_name" content="Diablo2 Profile">
  <meta property="og:url" content="https://dayyoung.github.io/diabloapp/d2/">
  <meta property="og:title" content="Diablo2 Profile">
  <meta property="og:image" content="https://dayyoung.github.io/diabloapp/d2/previewlogo.jpg">
  <meta property="og:locale" content="ko_KR">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="../ms-icon-144x144.png">
  <!-- Chrome, Firefox OS, Opera -->
  <meta name="theme-color" content="#484848">
  <meta HTTP-EQUIV="Pragma" CONTENT="no-cache">
  <meta HTTP-EQUIV="Expires" CONTENT="-1">
  <meta http-equiv="refresh" content="-1">

  <link rel="apple-touch-icon-precomposed" href="../apple-icon-152x152.png">
  <link rel="apple-touch-startup-image" href="../apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="57x57" href="../apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="../apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="../apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="../apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="../apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="../apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="../apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="../apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="../apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="../android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
  <link rel="manifest" href="./manifest.json">
  <link rel="shortcut icon" href="../favicon.png">

<!-- 
  <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsenui.css">
  <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsen-css-components.min.css">
  <script src="https://unpkg.com/onsenui/js/onsenui.min.js"></script>
 -->
  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
  <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
  <link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css"/>

  <style>

.tabbar:not(.tabbar--top) {
    padding-bottom: 0;
    position: fixed;
}


  html, body {
    margin: 0;
    padding: 0;
  }
  body {
    background-color: #484848; 
  }


  #captionLayout {
    //background-color:transparent !important; 
    cursor : pointer;
  }


  #myImg{
      height: 100%;
      width: 100%;
  }


   /* 메인 컨테이너에 다음과 같이 설정 */
  #mainLayout {
    padding:
      env(safe-area-inset-top)
      env(safe-area-inset-right)
      env(safe-area-inset-bottom)
      env(safe-area-inset-left);
  }

  :root {
      --sat2: 100;
      --sat: env(safe-area-inset-top);
      --sar: env(safe-area-inset-right);
      --sab: env(safe-area-inset-bottom);
      --sal: env(safe-area-inset-left);
  }

  </style>
     
  </head>
  <body>

  <div id="mainLayout">

 <!--  <div id="captionLayout" class="tooltip" style="display: block;  width: 100px;height: 100px;  position:absolute;background-color:greenyellow;opacity:0.7;z-index: 100;top: 0; margin-left: 10; margin-top: 0;">
          <span class="tooltiptext" onclick="addNewLayout()">!!!</span>
  </div> 
 -->

  <center>
  <div id="header" style="position: block; width : 100%; height:50px">
   <font size=6 color="white">- Diablo2 Reseraction -</font>
  </div>
  </center>

  <div id="body">
  <img onload="onCreate();getBase64Image(this);" id="myImg" src="" height="100%" width="100%" class="fixed" style="max-width: 1800px; z-index: 100; position:block;">

  <img onload="getBase64Image(this)" id="downloadImg" src="" height="100%" width="100%" style="display: none;">
  </img>
  </div>

  <center>
  <div id="footer" style="width : 100%; height:50px">
   <input type="button" value="Home" onclick="drawItem(1)" style="width:60px; height: 40px;" />
   <input type="button" value="Image" onclick="drawItem(2)" style="width:60px; height: 40px;" />
   <input type="button" value="Position" onclick="drawItem(3)" style="width:60px; height: 40px;" />
   <input type="button" value="Share" onclick="alert('Comming soon!')" style="width:60px; height: 40px;" />
  </div>
  </center>

  </div>


  <script>

function readURL(id, input) {

  console.log(id)

 if (input.files && input.files[0]) {
  var reader = new FileReader();
  
  reader.onload = function (e) {
   $('#myImg').attr('src', e.target.result); 
    console.log(e.target.result)
    localStorage.setItem("imgData", e.target.result.replace(/^data:image\/(png|jpg);base64,/, ""));

  }
  
  reader.readAsDataURL(input.files[0]);
  }
}

function getBase64Image(img) {

  return;

  var canvas = document.createElement("canvas");

  var img = document.getElementById("myImg");

  var size = {
    width: document.body.innerWidth || document.body.clientWidth, // for except scroll
    //width: window.innerWidth || document.body.clientWidth,
    height: window.innerHeight || document.body.clientHeight 
  };

  var myImg = document.getElementById("myImg");
  var pageWidth  = size.width;
  //var pageWidth  = myImg.width;
  var pageHeight = myImg.height;


  if(size.width<size.height){
    pageWidth = pageWidth * 2
    $("#mainLayout").css("width" , pageWidth);  
  }else{
    $("#mainLayout").css("width" , pageWidth);  
  }

    canvas.width = pageWidth;
    canvas.height = pageHeight;

    var ctx = canvas.getContext("2d");
    ctx.drawImage(img, 0, 0);

    var dataURL = canvas.toDataURL("image/png");

    console.log(dataURL)

    localStorage.setItem("imgData", dataURL.replace(/^data:image\/(png|jpg);base64,/, ""));

    return dataURL.replace(/^data:image\/(png|jpg);base64,/, "");
}

  function clip(){

    var url = '';
    var textarea = document.createElement("textarea");
    document.body.appendChild(textarea);
    url = window.document.location.href;
    textarea.value = url;
    textarea.select();
    document.execCommand("copy");
    document.body.removeChild(textarea);
    alert("Copied.")
  }

  var itemList = [{"id":1,"w":103,"h":196,"x":1051,"y":213,"caption":""},{"id":2,"w":104,"h":103,"x":1051,"y":421,"caption":""},{"id":3,"w":53,"h":57,"x":1170,"y":467,"caption":""},{"id":4,"w":102,"h":101,"x":1236,"y":188,"caption":""},{"id":5,"w":102,"h":151,"x":1234,"y":302,"caption":""},{"id":6,"w":99,"h":56,"x":1237,"y":468,"caption":""},{"id":7,"w":57,"h":54,"x":1348,"y":266,"caption":""},{"id":8,"w":57,"h":54,"x":1346,"y":468,"caption":""},{"id":9,"w":101,"h":191,"x":1420,"y":215,"caption":""},{"id":10,"w":99,"h":96,"x":1419,"y":424,"caption":""}];

  // url 에서 parameter 추출

  function getParam(sname) {

      var params = location.search.substr(location.search.indexOf("?") + 1);

      var sval = "";

      params = params.split("&");

      for (var i = 0; i < params.length; i++) {

          temp = params[i].split("=");

          if ([temp[0]] == sname) { sval = temp[1]; }

      }
      return sval;

  }

  var copyList = []

  function addNewLayout(){
        //var captionItem = cationpList[i]

        //if($('.caption'+i).length == 0){
          var copyCaption = $('<div id="" class="tooltip" style="display: block;  width: 100px;height: 100px;  position:absolute;background-color:greenyellow;opacity:0.7;z-index: 100;top: 0; margin-left: 10; margin-top: 0;"><span class="tooltiptext" onclick="addNewLayout()">!!!</span></div>').clone();
          //copyCaption.hide()

          copyCaption.css("z-index",99)
          copyCaption.attr('caption', (copyList.length+1))


          // copyCaption.hover(function(){
          //     console.log(JSON.stringify(copyList))

          //     var index = copyCaption.attr('caption')

          //     $("#myImg").attr("src","./"+index+".png")

          // }, function() {
          //     //console.log(cationpList)
          // });

          $("body").append(copyCaption)

          copyCaption.resizable();
          copyCaption.draggable();
          //cationpList.push(copyCaption)

          var obj = copyCaption
          var width = obj.width();
          var height = obj.height();
          var offset = copyCaption.offset();
          var xPos = offset.left;
          var yPos = offset.top;

          captionItem = {};
          captionItem.id = copyList.length+1;
          captionItem.w = width;
          captionItem.h = height;
          captionItem.x = xPos;
          captionItem.y = yPos;
          captionItem.caption = ''; 


          copyList.push(captionItem)
  }


var images = [
      "./0.png",
      "./1.png",
      "./2.png",
      "./3.png",
      "./4.png",
      "./5.png",
      "./6.png",
      "./7.png",
      "./8.png",
      "./9.png",
      "./10.png"];


const preload = (imageArray, index) => {
    index = index || 0;
    if (imageArray && imageArray.length > index) {
        const img = new Image();
        img.onload = () => {
            if(index+1 == imageArray.length){
              console.log("end2")
            }
            preload(imageArray, index + 1);
        }
        img.src = imageArray[index];
    }
}

console.log("start")
preload(images);

console.log("end1")


  $(function(){

    // 실행할 기능을 정의해주세요.
    var mode = getParam('mode')

    if(mode){
        $("#myImg").attr("src","./0.png")
    }else{
        $("#myImg").attr("src","./0.png")
    }

  var dataImage = localStorage.getItem('imgData');
  if(dataImage){
    bannerImg = document.getElementById('myImg');
    bannerImg.src = "data:image/png;base64," + dataImage;
  }

  });

  var refreshTimer;
  
  $(window).resize(function() { 
      onCreate()
  });

  var isFirst = true;
  var isEdit = false;
  var isUpload = false;
  var weightRate = 1;
  var marginTopForIphoneX = getComputedStyle(document.documentElement).getPropertyValue("--sat")

  function onCreate() {

  marginTopForIphoneX = parseInt($("#mainLayout").css("padding-top"))
  marginTopForIphoneX += parseInt($("#header").height())

  console.log("marginTop " + marginTopForIphoneX)

  var size = {
    width: document.body.innerWidth || document.body.clientWidth, // for except scroll
    //width: window.innerWidth || document.body.clientWidth,
    height: window.innerHeight || document.body.clientHeight 
  };

  var myImg = document.getElementById("myImg");
  var pageWidth  = size.width;
  //var pageWidth  = myImg.width;
  var pageHeight = myImg.height;


  if(size.width<size.height){
    pageWidth = pageWidth * 2
    $("#mainLayout").css("width" , pageWidth);  
  }else{
    $("#mainLayout").css("width" , pageWidth);  
  }

// console.log()
//   $('#home').height(pageHeight)

  weightRate = pageWidth / 1680

  //console.log(pageWidth)
  //console.log(pageHeight)
  console.log(marginTopForIphoneX)

  var marginWidth = (size.width - pageWidth ) / 2
  var marginHeight = pageHeight - size.height

  if(isUpload){
    //drawItem(1)
    return;
  }

  if(isEdit){
    //drawItem(1)
    return;
  }
  if(!isFirst){
    drawItem(1)
    return;
  }

  isFirst = false;

     // $( "#captionLayout" ).draggable({
     //    start: function() {
          
     //    },
     //    drag: function() {
          

     //      var obj = $(this)
     //      var width = obj.width();
     //      var height = obj.height();
     //      var offset = $(this).offset();
     //      var xPos = offset.left;
     //      var yPos = offset.top;

     //      $(this).find(".captionText").html("size : " + width + " / " + height + "<br>" + "position : " + xPos + " / " + yPos)
     //      var sample = {'id':'','w':width,'h':height,'x':xPos,'y':yPos,'caption':''}
     //      console.log(JSON.stringify(sample))

     //    },
     //    stop: function() {
     //    }
     //  });

     // $( "#captionLayout" ).resizable({
     //    start: function() {
          
     //    },
     //    resize: function() {
          

     //      var obj = $(this)
     //      var width = obj.width();
     //      var height = obj.height();
     //      var offset = $(this).offset();
     //      var xPos = offset.left;
     //      var yPos = offset.top;

     //      $(this).find(".captionText").html("size : " + width + " / " + height + "<br>" + "position : " + xPos + " / " + yPos)
     //      var sample = {'id':'','w':width,'h':height,'x':xPos,'y':yPos,'caption':''}
     //      console.log(JSON.stringify(sample))

     //    },
     //    stop: function() {
     //    }
     //  });
$( "#captionLayout" ).resizable();
$( "#captionLayout" ).draggable();
     drawItem(1); 
}

  function drawItem(mode){

        for(i in itemList)
        {
        var captionItem = itemList[i]


        //background-color:transparent !important;

        if($('.caption'+i).length == 0){
          var copyCaption = $('<div id="" class="tooltip" style="display: block;  width: 100px;height: 100px;  position:absolute;z-index: 100;top: 0; margin-left: 10; margin-top: 0;"><span class="tooltiptext" onclick="addNewLayout()">!!!</span><input type="file" class="imgInput" style="display:none"/></div>').clone();
          copyCaption.addClass('caption'+i)
          $("body").append(copyCaption)
        }else{
          var copyCaption = $('.caption'+i)
        }
        copyCaption.attr('caption', captionItem.id);

        copyCaption.css("width", captionItem.w * weightRate);
        copyCaption.css("height", captionItem.h * weightRate);
        copyCaption.css("left", captionItem.x * weightRate);
        copyCaption.css("margin-top", captionItem.y * weightRate + marginTopForIphoneX);

        copyCaption.find(".tooltiptext").html(captionItem.caption)
        
        console.log("MODE >> " + mode)

        if(mode == 1){
        isEdit = false
        isUpload = false
        copyCaption.css("background-color","transparent")
        //copyCaption.css("opacity","0.7")
        copyCaption.find(".imgInput").hide()
        }
        if(mode == 2){
        isEdit = false
        isUpload = true
        copyCaption.css("background-color","red")
        copyCaption.css("opacity","0.7")
        copyCaption.find(".imgInput").show()
        copyCaption.find(".imgInput").change(function(){
           readURL(captionItem.id, this);
        });
        }
        if(mode == 3){
        isEdit = true
        isUpload = false
        copyCaption.css("background-color","greenyellow")
        copyCaption.css("opacity","0.7")
        copyCaption.find(".imgInput").hide()
        }

        if(mode == 3){

           copyCaption.draggable({
              start: function() {
                
              },
              drag: function() {
              },
              stop: function() {

                var obj = $(this)

                var id = obj.attr('caption')
                var width = obj.width();
                var height = obj.height();
                var offset = obj.offset();
                var xPos = offset.left;
                var yPos = offset.top;

                
                for(i in itemList)
                {
                  var captionItem = itemList[i]
                  if(captionItem.id == id){
                    captionItem.w = width;
                    captionItem.h = height;
                    captionItem.x = xPos;
                    captionItem.y = yPos;
                  }
                }
                

                console.log(JSON.stringify(itemList))


              }, disabled : false
            });

           copyCaption.resizable({
              start: function() {
                
              },
              resize: function() {
     
              },
              stop: function() {

           
                var obj = $(this)

                var id = obj.attr('caption')
                var width = obj.width();
                var height = obj.height();
                var offset = obj.offset();
                var xPos = offset.left;
                var yPos = offset.top;

            
                for(i in itemList)
                {
                  var captionItem = itemList[i]
                  if(captionItem.id == id){
                    captionItem.w = width;
                    captionItem.h = height;
                    captionItem.x = xPos;
                    captionItem.y = yPos;
                  }
                }
                console.log(JSON.stringify(itemList))

              }, disabled : false
            });

        }else{
          copyCaption.draggable({ disabled: true });  
          copyCaption.resizable({ disabled: true });  
        }

        copyCaption.show()

        // copyCaption.hover(function(){
       
        //     var index = $(this).attr('caption')

        //     $("#myImg").attr("src","./"+index+".png")

        // }, function() {
        //     $("#myImg").attr("src","./0.png")
        // });

      }
  }
    
  </script>


  </body>
  </html>  
